<html>
  <head>
    <style>
      canvas { width: 100%; height: 100%; background-color: black; }
    </style>
    <script src="./three.js"></script>
    <script src="../leap.js"></script>
  </head>
  <body>
    <script>
      var scene = new THREE.Scene();
      var camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.10, 1000);
      var renderer = new THREE.WebGLRenderer();
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement); 
      camera.position.z = 500;
      camera.position.y = -100;
      camera.lookAt(new THREE.Vector3(0,20,0))

      var pointers = {};
      Leap.loop(function(frame) {
        var pointableIds = {};
        for (var pointableId = 0, pointableCount = frame.pointables.length; pointableId != pointableCount; pointableId++) {
          var pointable = frame.pointables[pointableId];
          var pointer = pointers[pointable.id]
          var origin = new THREE.Vector3(pointable.tipPosition[0], pointable.tipPosition[1], pointable.tipPosition[2])
          var direction = new THREE.Vector3(pointable.direction[0], pointable.direction[1], -pointable.direction[2]);
          if (!pointer) {
            pointer = new THREE.ArrowHelper(origin, direction, pointable.length);
            pointer.cone.position.set( 0, 1, 0 );
            pointers[pointable.id] = pointer;
            scene.add(pointer);
          } else {
            pointer.position = origin
            pointer.setDirection(direction)
          }
          pointer.length = pointable.length
          pointableIds[pointable.id] = true
        }

        for (pointableId in pointers) {
          if (!pointableIds[pointableId]) {
            //console.log("not in scene!"+pointableId)
            scene.remove(pointers[pointableId])
            delete pointers[pointableId]
          }
        }

        //cube.rotation.x += 0.1;
        //cube.rotation.y += 0.1;
        renderer.render(scene, camera);
      });
    </script>
    <div id="out"></div>
  </body>
</html>
